---
- name: Deploy index.php template
  ansible.builtin.template:
    src: index.php.j2
    dest: /var/www/html/index.php
    owner: www-data
    group: www-data
    mode: '0644'
  notify: Restart PHP-FPM

- name: Deploy nginx.conf template
  ansible.builtin.template:
    src: nginx.conf.j2
    dest: /etc/nginx/sites-available/default
    owner: root
    group: root
    mode: '0644'
  notify: Restart Nginx

- name: Ensure Logrotate Configuration for Nginx
  ansible.builtin.copy:
    dest: /etc/logrotate.d/nginx
    owner: root
    group: root
    mode: '0644'
    content: |
      /var/log/nginx/*.log {
          daily
          missingok
          rotate 14
          compress
          delaycompress
          notifempty
          create 0640 www-data adm
          sharedscripts
          postrotate
              systemctl reload nginx > /dev/null 2>/dev/null || true
          endscript
      }
  notify: Restart Nginx
